!function(e){var o={};function n(t){if(o[t])return o[t].exports;var r=o[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=o,n.d=function(e,o,t){n.o(e,o)||Object.defineProperty(e,o,{enumerable:!0,get:t})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,o){if(1&o&&(e=n(e)),8&o)return e;if(4&o&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(n.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&o&&"string"!=typeof e)for(var r in e)n.d(t,r,function(o){return e[o]}.bind(null,r));return t},n.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(o,"a",o),o},n.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)},n.p="",n(n.s=0)}([function(e,o,n){"use strict";var t=function(e){return e&&e.__esModule?e:{default:e}}(n(1));var r,i={audio:!0};function c(){chrome.tabs.executeScript({file:"js/lib/socket.io.js"},s)}function s(){chrome.tabs.executeScript({file:"js/inject.js"},function(){chrome.runtime.lastError?console.error(chrome.runtime.lastError.message):console.log("All scripts successfully loaded")})}chrome.runtime.onConnect.addListener(function(e){r=e,e.onMessage.addListener(function(e){"init"==e.type&&l.emit("create room")})}),chrome.browserAction.onClicked.addListener(function(){console.log("Starting Toonin Script Injection"),chrome.tabs.executeScript({file:"js/lib/adapter.js"},c)}),console.log("application script running");var a,d,l=io("http://206.189.69.217:8100"),u={},f={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun3.l.google.com:19302","stun:stun4.l.google.com:19302"]}]},p={offerToReceiveAudio:1};l.on("room created",function(e){console.log("New room created with ID: "+e),d=e,r.postMessage({type:"roomID",roomID:e}),chrome.tabCapture.capture(i,function(e){if(e){var o=e.getAudioTracks(),n=new MediaStream(o);window.audio=document.createElement("audio"),window.audio.srcObject=n,window.audio.play(),a=n,console.log("Tab audio captured. Now sending url to injected content script")}else console.error("Error starting tab capture: "+(chrome.runtime.lastError.message||"UNKNOWN"))})}),l.on("peer joined",function(e){console.log("New peer has joined the room"),u[e.id]={id:e.id,room:e.room,iceCandidates:[]},function(e){console.log("Starting new connection for peer: "+e);var o=new RTCPeerConnection(f);o.addStream(a),u[e].rtcConn=o,console.log(u),u[e].rtcConn.onicecandidate=function(o){o.candidate?(u[e].iceCandidates.push(o.candidate),l.emit("src new ice",{id:e,room:d,candidate:o.candidate})):console.log("No candidate for RTC connection")},o.createOffer(p).then(function(n){t.default.preferOpus(n.sdp),o.setLocalDescription(new RTCSessionDescription(n)).then(function(){u[e].localDesc=n,l.emit("src new desc",{id:e,room:d,desc:n})})})}(e.id)}),l.on("peer ice",function(e){console.log("Ice Candidate from peer: "+e.id+" in room: "+e.room),console.log("Ice Candidate: "+e.candidate),d==e.room&&e.id in u?u[e.id].rtcConn.addIceCandidate(new RTCIceCandidate(e.candidate)).then(console.log("Ice Candidate added successfully for peer: "+e.id)).catch(function(e){console.log("Error on addIceCandidate: "+e)}):console.log("Ice Candidate not for me")}),l.on("peer desc",function(e){console.log("Answer description from peer: "+e.id+" in room: "+e.room),console.log("Answer description: "+e.desc),d==e.room&&e.id in u?u[e.id].rtcConn.setRemoteDescription(new RTCSessionDescription(e.desc)).then(function(){console.log("Remote description set successfully for peer: "+e.id)}).catch(function(e){console.log("Error on setRemoteDescription: "+e)}):console.log("Answer Description not for me")})},function(e,o,n){"use strict";var t=function(e,o){var n=e.match(o);return n&&2==n.length?n[1]:null},r=function(e,o){for(var n=e.split(" "),t=new Array,r=0,i=0;i<n.length;i++)3===r&&(t[r++]=o),n[i]!==o&&(t[r++]=n[i]);return t.join(" ")},i=function(e,o){for(var n=e[o].split(" "),r=e.length-1;r>=0;r--){var i=t(e[r],/a=rtpmap:(\d+) CN\/\d+/i);if(i){var c=n.indexOf(i);-1!==c&&n.splice(c,1),e.splice(r,1)}}return e[o]=n.join(" "),e};e.exports={preferOpus:function(e){for(var o=e.split("\r\n"),n=0;n<o.length;n++)if(-1!==o[n].search("m=audio")){var c=n;break}if(null===c)return e;for(n=0;n<o.length;n++)if(-1!==o[n].search("opus/48000")){var s=t(o[n],/:(\d+) opus\/48000/i);s&&(o[c]=r(o[c],s));break}return e=(o=i(o,c)).join("\r\n")}}}]);